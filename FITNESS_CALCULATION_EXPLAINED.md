# é€‚åº”åº¦è®¡ç®—è¯¦è§£

## ğŸ¯ **é€‚åº”åº¦è®¡ç®—æ¦‚è¿°**

å½“å‰ç³»ç»Ÿä½¿ç”¨**å¤šå±‚æ¬¡é€‚åº”åº¦è¯„ä¼°**ï¼Œæ ¹æ®é…ç½®ä¸åŒæœ‰ä¸¤ç§æ¨¡å¼ï¼š

### ğŸ“Š **1. å•ç›®æ ‡æ¨¡å¼ (å½“å‰ULTRA_FAST_CONFIG)**
- åªå…³æ³¨**å¤æ™®æ¯”ç‡**ä½œä¸ºé€‚åº”åº¦æŒ‡æ ‡
- è®¡ç®—å…¬å¼ï¼š`fitness = sharpe_ratio`

### ğŸ¯ **2. å¤šç›®æ ‡æ¨¡å¼ (å®Œæ•´å¢å¼ºç‰ˆ)**
- ç»¼åˆå¤šä¸ªäº¤æ˜“æŒ‡æ ‡
- ä½¿ç”¨åŠ æƒç»„åˆè®¡ç®—æœ€ç»ˆé€‚åº”åº¦

---

## ğŸ” **è¯¦ç»†è®¡ç®—æµç¨‹**

### **ç¬¬ä¸€æ­¥ï¼šä¸ªä½“å‚æ•°æå–**

æ¯ä¸ªä¸ªä½“åŒ…å«ä»¥ä¸‹å‚æ•°ï¼š
```python
# ä¸ªä½“ç»“æ„ï¼š[æƒé‡(feature_dim), åç½®, ä¹°å…¥é˜ˆå€¼, å–å‡ºé˜ˆå€¼, æ­¢æŸ, æœ€å¤§ä»“ä½, æœ€å¤§å›æ’¤, äº¤æ˜“ä»“ä½]
weights = population[:, :feature_dim]           # ç¥ç»ç½‘ç»œæƒé‡
biases = population[:, feature_dim]             # åç½®
buy_thresholds = population[:, feature_dim + 1] # ä¹°å…¥é˜ˆå€¼ [0.55, 0.8]
sell_thresholds = population[:, feature_dim + 2] # å–å‡ºé˜ˆå€¼ [0.2, 0.45]
stop_losses = population[:, feature_dim + 3]    # æ­¢æŸæ¯”ä¾‹ [0.02, 0.08]
max_positions = population[:, feature_dim + 4]  # æœ€å¤§ä»“ä½ [0.5, 1.0]
max_drawdowns = population[:, feature_dim + 5]  # æœ€å¤§å›æ’¤ [0.1, 0.25]
trade_positions = population[:, feature_dim + 6] # äº¤æ˜“ä»“ä½ [0.01, 0.81]
```

### **ç¬¬äºŒæ­¥ï¼šä¿¡å·ç”Ÿæˆ**

```python
# è®¡ç®—é¢„æµ‹ä¿¡å· [ç§ç¾¤å¤§å°, æ ·æœ¬æ•°]
signals = torch.sigmoid(torch.matmul(weights, features.T) + biases.unsqueeze(1))
```

**è§£é‡Š**ï¼š
- ä½¿ç”¨ç¥ç»ç½‘ç»œè®¡ç®—æ¯ä¸ªæ—¶é—´ç‚¹çš„äº¤æ˜“ä¿¡å·
- Sigmoidå‡½æ•°å°†è¾“å‡ºæ˜ å°„åˆ°[0,1]åŒºé—´
- 0.5ä»¥ä¸Šå€¾å‘ä¹°å…¥ï¼Œ0.5ä»¥ä¸‹å€¾å‘å–å‡º

### **ç¬¬ä¸‰æ­¥ï¼šäº¤æ˜“æ¨¡æ‹Ÿ**

#### **3.1 äº¤æ˜“å†³ç­–ç”Ÿæˆ**
```python
# ç”Ÿæˆä¹°å–ä¿¡å·
buy_signals = (signals > buy_thresholds).float()   # ä¿¡å·è¶…è¿‡ä¹°å…¥é˜ˆå€¼
sell_signals = (signals < sell_thresholds).float() # ä¿¡å·ä½äºå–å‡ºé˜ˆå€¼
```

#### **3.2 ä»“ä½è®¡ç®—**
```python
# åŸºäºä¿¡å·å¼ºåº¦è®¡ç®—ä»“ä½
signal_strength = torch.sigmoid((signals - 0.5) * 4)  # ä¿¡å·å¼ºåº¦æ˜ å°„
positions = signal_strength * max_positions           # å®é™…ä»“ä½
```

#### **3.3 æ”¶ç›Šè®¡ç®—**
```python
# è®¡ç®—æ¯ä¸ªæ—¶é—´ç‚¹çš„æ”¶ç›Š
period_returns = labels.unsqueeze(0).expand(population_size, -1)
portfolio_returns = positions * period_returns        # ç»„åˆæ”¶ç›Š
portfolio_values = torch.cumprod(1 + portfolio_returns, dim=1)  # ç´¯ç§¯ä»·å€¼
```

### **ç¬¬å››æ­¥ï¼šæ€§èƒ½æŒ‡æ ‡è®¡ç®—**

#### **4.1 å¤æ™®æ¯”ç‡ (Sharpe Ratio)**
```python
mean_returns = torch.mean(portfolio_returns, dim=1)
std_returns = torch.std(portfolio_returns, dim=1) + 1e-8
sharpe_ratios = mean_returns / std_returns
```

**å«ä¹‰**ï¼šé£é™©è°ƒæ•´åæ”¶ç›Šï¼Œè¶Šé«˜è¶Šå¥½
- **è®¡ç®—**ï¼šå¹³å‡æ”¶ç›Š / æ”¶ç›Šæ ‡å‡†å·®
- **èŒƒå›´**ï¼šé€šå¸¸åœ¨-3åˆ°3ä¹‹é—´ï¼Œ>1ä¸ºè‰¯å¥½

#### **4.2 æœ€å¤§å›æ’¤ (Maximum Drawdown)**
```python
running_max = torch.cummax(portfolio_values, dim=1)[0]
drawdowns = (running_max - portfolio_values) / running_max
max_drawdowns = torch.max(drawdowns, dim=1)[0]
```

**å«ä¹‰**ï¼šæœ€å¤§äºæŸå¹…åº¦ï¼Œè¶Šå°è¶Šå¥½
- **è®¡ç®—**ï¼š(å†å²æœ€é«˜ç‚¹ - å½“å‰ç‚¹) / å†å²æœ€é«˜ç‚¹
- **èŒƒå›´**ï¼š0åˆ°1ä¹‹é—´ï¼Œ<0.1ä¸ºè‰¯å¥½

#### **4.3 æ€»æ”¶ç›Šç‡ (Total Return)**
```python
total_return = portfolio_values[:, -1] - 1.0  # æœ€ç»ˆä»·å€¼ - åˆå§‹ä»·å€¼
```

**å«ä¹‰**ï¼šæ€»ä½“æ”¶ç›Šç‡ï¼Œè¶Šé«˜è¶Šå¥½

#### **4.4 èƒœç‡ (Win Rate)**
```python
winning_trades = daily_pnl > 0
win_rate = torch.sum(winning_trades, dim=1).float() / total_trades
```

**å«ä¹‰**ï¼šç›ˆåˆ©äº¤æ˜“å æ¯”ï¼Œè¶Šé«˜è¶Šå¥½
- **èŒƒå›´**ï¼š0åˆ°1ä¹‹é—´ï¼Œ>0.5ä¸ºè‰¯å¥½

#### **4.5 äº¤æ˜“é¢‘ç‡ (Trade Frequency)**
```python
position_changes = torch.abs(torch.diff(positions, dim=1))
trade_frequency = torch.mean(position_changes, dim=1)
```

**å«ä¹‰**ï¼šäº¤æ˜“æ´»è·ƒåº¦ï¼Œé€‚ä¸­ä¸ºå¥½
- å¤ªé«˜ï¼šè¿‡åº¦äº¤æ˜“ï¼Œæ‰‹ç»­è´¹é«˜
- å¤ªä½ï¼šé”™å¤±æœºä¼š

#### **4.6 æ³¢åŠ¨ç‡ (Volatility)**
```python
volatility = torch.std(portfolio_returns, dim=1)
```

**å«ä¹‰**ï¼šæ”¶ç›Šæ³¢åŠ¨æ€§ï¼Œè¶Šå°è¶Šç¨³å®š

#### **4.7 ç›ˆäºæ¯” (Profit Factor)**
```python
gross_profit = torch.sum(torch.clamp(daily_pnl, min=0), dim=1)
gross_loss = torch.sum(torch.clamp(daily_pnl, max=0), dim=1)
profit_factor = gross_profit / torch.abs(gross_loss)
```

**å«ä¹‰**ï¼šæ€»ç›ˆåˆ©/æ€»äºæŸï¼Œ>1ä¸ºç›ˆåˆ©

---

## âš–ï¸ **é€‚åº”åº¦ç»¼åˆè®¡ç®—**

### **å•ç›®æ ‡æ¨¡å¼ (å½“å‰é…ç½®)**
```python
fitness = sharpe_ratio  # åªå…³æ³¨å¤æ™®æ¯”ç‡
```

### **å¤šç›®æ ‡æ¨¡å¼ (å®Œæ•´ç‰ˆ)**
```python
# åŠ æƒç»„åˆ
fitness = (
    0.3 * sharpe_ratio +           # 30% å¤æ™®æ¯”ç‡
    0.2 * (-max_drawdown) +        # 20% æœ€å¤§å›æ’¤(æœ€å°åŒ–)
    0.25 * total_return +          # 25% æ€»æ”¶ç›Šç‡
    0.15 * win_rate +              # 15% èƒœç‡
    0.1 * (-volatility)            # 10% æ³¢åŠ¨ç‡(æœ€å°åŒ–)
)
```

**æƒé‡è¯´æ˜**ï¼š
- **æœ€å°åŒ–ç›®æ ‡**ï¼šmax_drawdown, volatility (å‰é¢åŠ è´Ÿå·)
- **æœ€å¤§åŒ–ç›®æ ‡**ï¼šsharpe_ratio, total_return, win_rate
- **æƒé‡å’Œ**ï¼šå¿…é¡»ç­‰äº1.0

---

## ğŸ“ˆ **é€‚åº”åº¦å€¼çš„å«ä¹‰**

### **å¤æ™®æ¯”ç‡é€‚åº”åº¦ (å½“å‰æ¨¡å¼)**
- **> 2.0**ï¼šä¼˜ç§€ç­–ç•¥
- **1.0 - 2.0**ï¼šè‰¯å¥½ç­–ç•¥  
- **0.5 - 1.0**ï¼šä¸€èˆ¬ç­–ç•¥
- **< 0.5**ï¼šè¾ƒå·®ç­–ç•¥
- **< 0**ï¼šäºæŸç­–ç•¥

### **å¤šç›®æ ‡ç»¼åˆé€‚åº”åº¦**
- **> 1.5**ï¼šä¼˜ç§€ç­–ç•¥
- **1.0 - 1.5**ï¼šè‰¯å¥½ç­–ç•¥
- **0.5 - 1.0**ï¼šä¸€èˆ¬ç­–ç•¥
- **0 - 0.5**ï¼šè¾ƒå·®ç­–ç•¥
- **< 0**ï¼šäºæŸç­–ç•¥

---

## ğŸ”§ **é€‚åº”åº¦ä¼˜åŒ–æœºåˆ¶**

### **1. ç²¾è‹±ä¿ç•™**
- ä¿ç•™é€‚åº”åº¦æœ€é«˜çš„5%ä¸ªä½“
- ç¡®ä¿ä¼˜ç§€åŸºå› ä¸ä¸¢å¤±

### **2. é”¦æ ‡èµ›é€‰æ‹©**
- éšæœºé€‰æ‹©å‡ ä¸ªä¸ªä½“æ¯”è¾ƒé€‚åº”åº¦
- é€‚åº”åº¦é«˜çš„æ›´å®¹æ˜“è¢«é€‰ä¸­ç¹æ®–

### **3. æ—©åœæœºåˆ¶**
- è¿ç»­50ä»£æ— æ”¹è¿›åˆ™åœæ­¢è®­ç»ƒ
- åŸºäºå¹³å‡é€‚åº”åº¦åˆ¤æ–­æ”¹è¿›

### **4. æ•°æ®é€€ç«**
- ä»ç®€å•æ•°æ®é€æ¸è¿‡æ¸¡åˆ°å¤æ‚æ•°æ®
- å¸®åŠ©ç®—æ³•æ›´å¥½åœ°å­¦ä¹ äº¤æ˜“æ¨¡å¼

---

## ğŸ¯ **å½“å‰é…ç½®çš„é€‚åº”åº¦ç‰¹ç‚¹**

ç”±äºä½¿ç”¨`ULTRA_FAST_CONFIG`ï¼š

1. **å•ä¸€ç›®æ ‡**ï¼šåªä¼˜åŒ–å¤æ™®æ¯”ç‡
2. **ç®€åŒ–è®¡ç®—**ï¼šé¿å…å¤æ‚çš„å¤šç›®æ ‡è®¡ç®—
3. **å¿«é€Ÿæ”¶æ•›**ï¼šä¸“æ³¨å•ä¸€æŒ‡æ ‡ï¼Œæ”¶æ•›æ›´å¿«
4. **é£é™©è°ƒæ•´**ï¼šå¤æ™®æ¯”ç‡æœ¬èº«å°±è€ƒè™‘äº†é£é™©

**ä¼˜ç‚¹**ï¼š
- è®¡ç®—é€Ÿåº¦å¿«
- å®¹æ˜“ç†è§£å’Œè°ƒè¯•
- é£é™©è°ƒæ•´æ”¶ç›Šæ˜¯äº¤æ˜“çš„æ ¸å¿ƒæŒ‡æ ‡

**ç¼ºç‚¹**ï¼š
- å¯èƒ½å¿½ç•¥å…¶ä»–é‡è¦æŒ‡æ ‡
- ç­–ç•¥å¯èƒ½è¿‡äºæ¿€è¿›æˆ–ä¿å®ˆ

---

## ğŸ” **å¦‚ä½•è§£è¯»JSONä¸­çš„é€‚åº”åº¦**

åœ¨`enhanced_training_history.jsonl`ä¸­ï¼š

```json
{
  "best_fitness": 1.234567,      // å½“å‰ä»£æœ€ä½³é€‚åº”åº¦(å¤æ™®æ¯”ç‡)
  "avg_fitness": 0.987654,       // å½“å‰ä»£å¹³å‡é€‚åº”åº¦
  "avg_sharpe_ratio": 1.234567,  // ç§ç¾¤å¹³å‡å¤æ™®æ¯”ç‡
  "avg_max_drawdown": 0.08,      // ç§ç¾¤å¹³å‡æœ€å¤§å›æ’¤
  "avg_total_return": 0.15       // ç§ç¾¤å¹³å‡æ€»æ”¶ç›Šç‡
}
```

**åˆ†æè¦ç‚¹**ï¼š
- `best_fitness`æŒç»­ä¸Šå‡è¡¨ç¤ºç­–ç•¥åœ¨æ”¹è¿›
- `avg_fitness`ä¸`best_fitness`å·®è·å¤§è¡¨ç¤ºç§ç¾¤å¤šæ ·æ€§é«˜
- `avg_sharpe_ratio`åº”è¯¥ä¸`best_fitness`æ¥è¿‘(å•ç›®æ ‡æ¨¡å¼)

è¿™å°±æ˜¯å½“å‰ç³»ç»Ÿçš„å®Œæ•´é€‚åº”åº¦è®¡ç®—æœºåˆ¶ï¼