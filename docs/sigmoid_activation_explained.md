# 🎯 Sigmoid激活函数在交易决策中的应用

## 📊 为什么使用Sigmoid激活函数？

### 🔄 原始问题
在没有激活函数的情况下：
```python
raw_scores = torch.mm(weights, features.T)  # 原始分数
# 范围: 可能是 [-∞, +∞]，实际通常在 [-50, +50] 左右
```

**问题**:
1. **不稳定**: 分数范围变化很大，难以设定固定阈值
2. **不直观**: 负数表示什么？正数又表示什么？
3. **难调参**: 阈值需要根据数据动态调整

### 🎯 Sigmoid解决方案
```python
raw_scores = torch.mm(weights, features.T)
scores = torch.sigmoid(raw_scores)  # 映射到 [0, 1]
```

**优势**:
1. **稳定范围**: 始终在 [0, 1] 区间
2. **直观解释**: 0.5 = 中性，>0.5 = 偏向买入，<0.5 = 偏向卖出
3. **易于调参**: 阈值含义明确且稳定

## 📈 Sigmoid函数特性

### 数学定义
```python
sigmoid(x) = 1 / (1 + e^(-x))
```

### 关键特点
```python
sigmoid(-∞) = 0      # 极度看空
sigmoid(-2)  ≈ 0.12  # 强烈看空  
sigmoid(-1)  ≈ 0.27  # 看空
sigmoid(0)   = 0.5   # 中性
sigmoid(1)   ≈ 0.73  # 看多
sigmoid(2)   ≈ 0.88  # 强烈看多
sigmoid(+∞)  = 1     # 极度看多
```

### 🎨 可视化理解
```
原始分数 → Sigmoid → 交易含义
-10      → 0.000   → 极度看空
-5       → 0.007   → 强烈看空
-2       → 0.119   → 看空
-1       → 0.269   → 轻微看空
0        → 0.500   → 中性
1        → 0.731   → 轻微看多
2        → 0.881   → 看多
5        → 0.993   → 强烈看多
10       → 1.000   → 极度看多
```

## 🔧 新的交易信号机制

### 信号生成逻辑
```python
# 基于 [0, 1] 区间的决策
buy_signals = scores > buy_threshold    # 例如 > 0.6
sell_signals = scores < sell_threshold  # 例如 < 0.4
# 中性区间: 0.4 ≤ scores ≤ 0.6 (不产生交易信号)
```

### 阈值设置指南

#### 🛡️ 保守策略
```python
buy_threshold = 0.7   # 只有非常确信时才买入
sell_threshold = 0.3  # 只有非常确信时才卖出
# 中性区间: [0.3, 0.7] = 40% 的范围
```

#### ⚖️ 平衡策略
```python
buy_threshold = 0.6   # 适度确信时买入
sell_threshold = 0.4  # 适度确信时卖出  
# 中性区间: [0.4, 0.6] = 20% 的范围
```

#### ⚡ 激进策略
```python
buy_threshold = 0.55  # 轻微偏向时就买入
sell_threshold = 0.45 # 轻微偏向时就卖出
# 中性区间: [0.45, 0.55] = 10% 的范围
```

## 📊 实际效果分析

### 原始分数 vs Sigmoid分数
```python
# 训练过程中的输出示例
第1代 原始[-8.23, +12.45] → Sigmoid[0.000, 1.000], 均值=0.501
第10代 原始[-5.67, +8.91] → Sigmoid[0.003, 0.999], 均值=0.498
第50代 原始[-3.21, +4.56] → Sigmoid[0.039, 0.990], 均值=0.502
```

### 交易信号分布
```python
# 不同阈值设置下的信号分布
保守策略 (0.7/0.3): 买入15%, 卖出12%, 中性73%
平衡策略 (0.6/0.4): 买入25%, 卖出22%, 中性53%  
激进策略 (0.55/0.45): 买入35%, 卖出33%, 中性32%
```

## 🎛️ 参数调优建议

### 1. 根据市场环境调整
```python
# 牛市环境 - 偏向买入
buy_threshold = 0.55  # 降低买入门槛
sell_threshold = 0.35 # 提高卖出门槛

# 熊市环境 - 偏向卖出
buy_threshold = 0.65  # 提高买入门槛  
sell_threshold = 0.45 # 降低卖出门槛

# 震荡市场 - 保守策略
buy_threshold = 0.7   # 高买入门槛
sell_threshold = 0.3  # 低卖出门槛
```

### 2. 根据风险偏好调整
```python
# 低风险偏好
buy_threshold = 0.75  # 非常确信才买入
sell_threshold = 0.25 # 非常确信才卖出

# 中等风险偏好  
buy_threshold = 0.6   # 适度确信买入
sell_threshold = 0.4  # 适度确信卖出

# 高风险偏好
buy_threshold = 0.52  # 轻微偏向就买入
sell_threshold = 0.48 # 轻微偏向就卖出
```

### 3. 动态阈值策略
```python
# 可以根据市场波动率动态调整阈值
volatility = calculate_market_volatility()

if volatility > 0.02:  # 高波动
    buy_threshold = 0.65  # 提高门槛
    sell_threshold = 0.35
else:  # 低波动
    buy_threshold = 0.55  # 降低门槛
    sell_threshold = 0.45
```

## 🔍 监控和调试

### 实时监控输出
```python
📊 第10代 Scores详细统计:
  原始分数: [-4.567, +6.234], 均值=0.123±2.456
  Sigmoid后: [0.010, 0.998], 均值=0.531±0.234
  中位数: 0.523
  分位数: P1=0.089, P5=0.156, P95=0.887, P99=0.967
  数据形状: torch.Size([500, 99654]) (种群大小 × 时间步数)
  交易信号: 买入12456次(25.0%), 卖出11234次(22.5%), 中性26098次(52.5%)
  阈值设置: 买入>0.6, 卖出<0.4, 中性区间[0.4, 0.6]
```

### 关键指标解读
1. **原始分数范围**: 反映权重和特征的匹配程度
2. **Sigmoid后分布**: 应该相对均匀分布在[0,1]
3. **信号比例**: 买入+卖出不应过高(避免过度交易)
4. **中性比例**: 适当的中性区间有助于减少噪音交易

## 💡 最佳实践

### 1. 初始设置
```python
# 推荐的初始配置
TRAINING_CONFIG = {
    "buy_threshold": 0.6,    # 60%确信度买入
    "sell_threshold": 0.4,   # 40%确信度卖出
}
```

### 2. 渐进式调优
```python
# 第一阶段：宽松阈值，观察分布
buy_threshold = 0.55, sell_threshold = 0.45

# 第二阶段：根据结果调整
if 交易过于频繁:
    buy_threshold = 0.65, sell_threshold = 0.35
elif 交易过于稀少:
    buy_threshold = 0.52, sell_threshold = 0.48
```

### 3. A/B测试
```python
# 同时测试多个阈值组合
configs = [
    {"buy": 0.6, "sell": 0.4},   # 基准
    {"buy": 0.65, "sell": 0.35}, # 保守
    {"buy": 0.55, "sell": 0.45}, # 激进
]
```

通过Sigmoid激活函数，我们将原本不稳定的决策分数转换为直观、稳定的概率值，使得交易策略更加可控和可解释。