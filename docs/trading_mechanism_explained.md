# ğŸ§¬ é—ä¼ ç®—æ³•äº¤æ˜“å‘˜åŸºå› ç»“æ„ä¸äº¤æ˜“æœºåˆ¶è¯¦è§£

## ğŸ“Š åŸºå› ç»“æ„æ¦‚è§ˆ

**æ³¨æ„**: æœ¬æ–‡æ¡£æè¿°çš„æ˜¯æ—§ç‰ˆæœ¬çš„å¤æ‚åŸºå› ç»“æ„ã€‚æ–°ç‰ˆæœ¬å·²ç®€åŒ–ä¸ºåªæœ‰1400ä¸ªç‰¹å¾æƒé‡ã€‚è¯¦è§ [simplified_trading_mechanism.md](simplified_trading_mechanism.md)

æ¯ä¸ªAIäº¤æ˜“å‘˜çš„åŸºå› ç”± **1405ä¸ªå‚æ•°** ç»„æˆï¼Œåˆ†ä¸ºä¸¤å¤§ç±»ï¼š

```
åŸºå› æ€»é•¿åº¦: 1405 (å·²ç®€åŒ–ä¸º1400)
â”œâ”€â”€ ç‰¹å¾æƒé‡ (1400ç»´): ç”¨äºåˆ†æå¸‚åœºæ•°æ®
â””â”€â”€ é£é™©å‚æ•° (5ç»´): æ§åˆ¶äº¤æ˜“è¡Œä¸ºå’Œé£é™©ç®¡ç† (å·²ç§»é™¤)
```

## ğŸ§¬ è¯¦ç»†åŸºå› ç»“æ„

### 1. ç‰¹å¾æƒé‡éƒ¨åˆ† (å‰1400ç»´)

```python
weights = population[:, :1400]  # å½¢çŠ¶: (ç§ç¾¤å¤§å°, 1400)
```

**ä½œç”¨**: è¿™1400ä¸ªæƒé‡å†³å®šäº†äº¤æ˜“å‘˜å¦‚ä½•è§£è¯»å¸‚åœºæ•°æ®
- æ¯ä¸ªæƒé‡å¯¹åº”ä¸€ä¸ªå¸‚åœºç‰¹å¾ï¼ˆå¦‚ä»·æ ¼å˜åŒ–ã€æˆäº¤é‡ã€æŠ€æœ¯æŒ‡æ ‡ç­‰ï¼‰
- æƒé‡å€¼èŒƒå›´: é€šå¸¸åœ¨ [-1, 1] ä¹‹é—´
- **æ­£æƒé‡**: è¯¥ç‰¹å¾æ”¯æŒä¹°å…¥å†³ç­–
- **è´Ÿæƒé‡**: è¯¥ç‰¹å¾æ”¯æŒå–å‡ºå†³ç­–
- **æƒé‡ç»å¯¹å€¼å¤§å°**: è¡¨ç¤ºè¯¥ç‰¹å¾çš„é‡è¦ç¨‹åº¦

**åˆå§‹åŒ–**:
```python
population[:, :1400] *= 0.1  # å°çš„åˆå§‹æƒé‡ï¼Œé¿å…è¿‡åº¦æ‹Ÿåˆ
```

### 2. é£é™©å‚æ•°éƒ¨åˆ† (å5ç»´)

#### å‚æ•°1-2: å†³ç­–é˜ˆå€¼ (ç»´åº¦1400-1401)
```python
buy_threshold = population[:, 1400]    # ä¹°å…¥é˜ˆå€¼
sell_threshold = population[:, 1401]   # å–å‡ºé˜ˆå€¼
```
- **èŒƒå›´**: [0.01, 0.11] (åˆå§‹åŒ–) â†’ [0.001, 0.2] (çº¦æŸå)
- **ä½œç”¨**: æ§åˆ¶äº¤æ˜“ä¿¡å·çš„æ•æ„Ÿåº¦
- **ä¹°å…¥æ¡ä»¶**: `å†³ç­–åˆ†æ•° > buy_threshold`
- **å–å‡ºæ¡ä»¶**: `å†³ç­–åˆ†æ•° < -sell_threshold`

#### å‚æ•°3: æ­¢æŸæ¯”ä¾‹ (ç»´åº¦1402)
```python
stop_loss = population[:, 1402]
```
- **èŒƒå›´**: [0.02, 0.08] (åˆå§‹åŒ–) â†’ [0.01, 0.1] (çº¦æŸå)
- **ä½œç”¨**: å½“ä»·æ ¼ä¸‹è·Œè¶…è¿‡æ­¤æ¯”ä¾‹æ—¶å¼ºåˆ¶å¹³ä»“
- **ä¾‹å­**: 0.05 è¡¨ç¤ºä»·æ ¼ä¸‹è·Œ5%æ—¶æ­¢æŸ

#### å‚æ•°4: æœ€å¤§ä»“ä½æ¯”ä¾‹ (ç»´åº¦1403)
```python
max_position = population[:, 1403]
```
- **èŒƒå›´**: [0.2, 0.8] (åˆå§‹åŒ–) â†’ [0.1, 1.0] (çº¦æŸå)
- **ä½œç”¨**: æ§åˆ¶å•æ¬¡äº¤æ˜“çš„æœ€å¤§èµ„é‡‘ä½¿ç”¨æ¯”ä¾‹
- **ä¾‹å­**: 0.5 è¡¨ç¤ºæœ€å¤šä½¿ç”¨50%çš„èµ„é‡‘è¿›è¡Œå•æ¬¡äº¤æ˜“

#### å‚æ•°5: æœ€å¤§å›æ’¤é™åˆ¶ (ç»´åº¦1404)
```python
max_drawdown = population[:, 1404]
```
- **èŒƒå›´**: [0.05, 0.15] (åˆå§‹åŒ–) â†’ [0.02, 0.3] (çº¦æŸå)
- **ä½œç”¨**: å½“è´¦æˆ·å›æ’¤è¶…è¿‡æ­¤æ¯”ä¾‹æ—¶å¼ºåˆ¶å¹³ä»“æ‰€æœ‰å¤´å¯¸
- **ä¾‹å­**: 0.1 è¡¨ç¤ºè´¦æˆ·å›æ’¤10%æ—¶å¼ºåˆ¶æ¸…ä»“

## ğŸ”„ äº¤æ˜“å†³ç­–æµç¨‹

### ç¬¬1æ­¥: ç‰¹å¾åˆ†æ
```python
# è®¡ç®—å†³ç­–åˆ†æ•° (GPUå¹¶è¡Œè®¡ç®—)
scores = torch.mm(weights, features.T)  # (ç§ç¾¤å¤§å°, æ—¶é—´æ­¥æ•°)
```
- å°†1400ä¸ªç‰¹å¾æƒé‡ä¸å½“å‰å¸‚åœºç‰¹å¾ç›¸ä¹˜æ±‚å’Œ
- å¾—åˆ°æ¯ä¸ªäº¤æ˜“å‘˜åœ¨æ¯ä¸ªæ—¶é—´ç‚¹çš„"å†³ç­–åˆ†æ•°"
- **æ­£åˆ†æ•°**: å€¾å‘ä¹°å…¥
- **è´Ÿåˆ†æ•°**: å€¾å‘å–å‡º
- **åˆ†æ•°ç»å¯¹å€¼**: è¡¨ç¤ºä¿¡å¿ƒå¼ºåº¦

### ç¬¬2æ­¥: ä¿¡å·ç”Ÿæˆ
```python
# ç”Ÿæˆäº¤æ˜“ä¿¡å·
buy_signals = scores > buy_threshold.unsqueeze(1)   # ä¹°å…¥ä¿¡å·
sell_signals = scores < -sell_threshold.unsqueeze(1) # å–å‡ºä¿¡å·
```

### ç¬¬3æ­¥: äº¤æ˜“æ‰§è¡Œé€»è¾‘

#### ä¹°å…¥æ¡ä»¶æ£€æŸ¥
```python
can_buy = (positions == 0) & buy_signals[:, t] & (~force_close)
new_position = torch.where(can_buy, max_position, positions)
```
**ä¹°å…¥æ¡ä»¶**:
1. å½“å‰æ— æŒä»“ (`positions == 0`)
2. ä¹°å…¥ä¿¡å·è§¦å‘ (`buy_signals[:, t]`)
3. æœªè¢«å¼ºåˆ¶å¹³ä»“ (`~force_close`)

#### å–å‡ºæ¡ä»¶æ£€æŸ¥
```python
can_sell = (positions > 0) & sell_signals[:, t]
new_position = torch.where(can_sell, torch.zeros_like(positions), new_position)
```
**å–å‡ºæ¡ä»¶**:
1. å½“å‰æœ‰æŒä»“ (`positions > 0`)
2. å–å‡ºä¿¡å·è§¦å‘ (`sell_signals[:, t]`)

#### é£é™©æ§åˆ¶æœºåˆ¶

**æ­¢æŸæ£€æŸ¥**:
```python
stop_loss_trigger = (positions > 0) & (price_change < -stop_loss)
positions = torch.where(stop_loss_trigger, torch.zeros_like(positions), positions)
```

**å›æ’¤æ§åˆ¶**:
```python
current_drawdown = (peak_equity - equity) / peak_equity
force_close = current_drawdown > max_drawdown
positions = torch.where(force_close, torch.zeros_like(positions), positions)
```

## ğŸ“ˆ æ”¶ç›Šè®¡ç®—ä¸é€‚åº”åº¦è¯„ä¼°

### æ”¶ç›Šè®¡ç®—
```python
# æ¯ä¸ªæ—¶é—´æ­¥çš„æ”¶ç›Š
period_return = positions * price_change
equity += period_return

# ç´¯è®¡ç»Ÿè®¡
sum_returns += period_return
sum_sq_returns += period_return.pow(2)
```

### é€‚åº”åº¦æŒ‡æ ‡

#### 1. å¤æ™®æ¯”ç‡ (Sharpe Ratio)
```python
mean_returns = sum_returns / n_samples
variance = sum_sq_returns / n_samples - mean_returns.pow(2)
std_returns = torch.sqrt(variance)
sharpe_ratios = mean_returns / (std_returns + 1e-9) * np.sqrt(252)
```
- **è¡¡é‡**: é£é™©è°ƒæ•´åçš„æ”¶ç›Š
- **å…¬å¼**: (å¹³å‡æ”¶ç›Š - æ— é£é™©æ”¶ç›Š) / æ”¶ç›Šæ ‡å‡†å·®
- **å¹´åŒ–**: ä¹˜ä»¥âˆš252 (äº¤æ˜“æ—¥æ•°)

#### 2. ç´¢æè¯ºæ¯”ç‡ (Sortino Ratio)
```python
downside_variance = downside_sum_sq_returns / n_samples
downside_std = torch.sqrt(downside_variance)
sortino_ratios = mean_returns / (downside_std + 1e-9) * np.sqrt(252)
```
- **è¡¡é‡**: åªè€ƒè™‘ä¸‹è¡Œé£é™©çš„æ”¶ç›Šæ¯”ç‡
- **ä¼˜åŠ¿**: ä¸æƒ©ç½šä¸Šè¡Œæ³¢åŠ¨

#### 3. æœ€å¤§å›æ’¤ (Maximum Drawdown)
```python
max_drawdowns = (peak_equity - equity) / peak_equity
```
- **è¡¡é‡**: ä»å†å²æœ€é«˜ç‚¹åˆ°å½“å‰çš„æœ€å¤§æŸå¤±æ¯”ä¾‹

#### 4. äº¤æ˜“ç¨³å®šæ€§
```python
stability_scores = 1.0 / (1.0 + trade_counts / n_samples)
```
- **è¡¡é‡**: äº¤æ˜“é¢‘ç‡çš„åˆç†æ€§
- **é¿å…**: è¿‡åº¦äº¤æ˜“

### ç»¼åˆé€‚åº”åº¦å‡½æ•°
```python
fitness = (0.5 * sharpe_ratios -      # 50%æƒé‡ï¼šé£é™©è°ƒæ•´æ”¶ç›Š
           0.3 * max_drawdowns +      # 30%æƒé‡ï¼šå›æ’¤æ§åˆ¶
           0.2 * stability_scores)    # 20%æƒé‡ï¼šäº¤æ˜“ç¨³å®šæ€§
```

## ğŸ§¬ è¿›åŒ–æœºåˆ¶

### 1. é€‰æ‹© (Tournament Selection)
- éšæœºé€‰æ‹©è‹¥å¹²ä¸ªä½“è¿›è¡Œ"é”¦æ ‡èµ›"
- é€‚åº”åº¦æœ€é«˜çš„ä¸ªä½“è·èƒœ
- è·èƒœè€…æœ‰æ›´é«˜æ¦‚ç‡ç¹æ®–åä»£

### 2. äº¤å‰ (Crossover)
```python
# å‡åŒ€äº¤å‰
mask = torch.rand(gene_length) < 0.5
child1 = torch.where(mask, parent1, parent2)
child2 = torch.where(mask, parent2, parent1)
```
- ä¸¤ä¸ªçˆ¶ä»£çš„åŸºå› éšæœºç»„åˆ
- äº§ç”Ÿå…·æœ‰æ··åˆç‰¹å¾çš„åä»£

### 3. å˜å¼‚ (Mutation)
```python
mutation_mask = torch.rand(pop_size, gene_length) < mutation_rate
mutation_values = torch.randn(pop_size, gene_length) * 0.01
new_population += mutation_mask * mutation_values
```
- ä»¥å°æ¦‚ç‡éšæœºæ”¹å˜åŸºå› 
- å¼•å…¥æ–°çš„äº¤æ˜“ç­–ç•¥å¯èƒ½æ€§
- é¿å…é™·å…¥å±€éƒ¨æœ€ä¼˜

### 4. ç²¾è‹±ä¿ç•™ (Elitism)
```python
elite_count = int(pop_size * elite_ratio)
elite_indices = torch.topk(fitness_scores, elite_count).indices
new_population[:elite_count] = population[elite_indices]
```
- ä¿ç•™å½“ä»£æœ€ä¼˜ä¸ªä½“
- ç¡®ä¿ä¼˜ç§€ç­–ç•¥ä¸ä¼šä¸¢å¤±

## ğŸ¯ å®é™…äº¤æ˜“ç¤ºä¾‹

å‡è®¾æŸä¸ªäº¤æ˜“å‘˜çš„åŸºå› å‚æ•°ä¸ºï¼š
- `buy_threshold = 0.05`
- `sell_threshold = 0.03`
- `stop_loss = 0.04`
- `max_position = 0.6`
- `max_drawdown = 0.08`

**äº¤æ˜“åœºæ™¯**:
1. **å¸‚åœºåˆ†æ**: ç‰¹å¾æƒé‡è®¡ç®—å¾—å‡ºå†³ç­–åˆ†æ•° = 0.07
2. **ä¹°å…¥åˆ¤æ–­**: 0.07 > 0.05 (ä¹°å…¥é˜ˆå€¼) â†’ è§¦å‘ä¹°å…¥ä¿¡å·
3. **ä»“ä½ç®¡ç†**: ä½¿ç”¨60%èµ„é‡‘ä¹°å…¥
4. **é£é™©æ§åˆ¶**: 
   - å¦‚æœä»·æ ¼ä¸‹è·Œ4%ï¼Œè§¦å‘æ­¢æŸ
   - å¦‚æœè´¦æˆ·å›æ’¤8%ï¼Œå¼ºåˆ¶æ¸…ä»“
5. **å–å‡ºåˆ¤æ–­**: å½“å†³ç­–åˆ†æ•° < -0.03æ—¶ï¼Œå–å‡ºå¹³ä»“

## ğŸš€ ç³»ç»Ÿä¼˜åŠ¿

1. **å¹¶è¡Œè®¡ç®—**: GPUåŒæ—¶è¯„ä¼°æ•°ç™¾ä¸ªäº¤æ˜“ç­–ç•¥
2. **è‡ªåŠ¨ä¼˜åŒ–**: é€šè¿‡è¿›åŒ–è‡ªåŠ¨å‘ç°æœ€ä¼˜å‚æ•°ç»„åˆ
3. **é£é™©æ§åˆ¶**: å†…ç½®å¤šå±‚é£é™©ç®¡ç†æœºåˆ¶
4. **é€‚åº”æ€§å¼º**: èƒ½å¤Ÿé€‚åº”ä¸åŒå¸‚åœºç¯å¢ƒ
5. **å¯è§£é‡Šæ€§**: æ¯ä¸ªå‚æ•°éƒ½æœ‰æ˜ç¡®çš„äº¤æ˜“å«ä¹‰

è¿™å¥—ç³»ç»Ÿé€šè¿‡æ¨¡æ‹Ÿè‡ªç„¶è¿›åŒ–è¿‡ç¨‹ï¼Œè®©AIäº¤æ˜“å‘˜åœ¨è™šæ‹Ÿç¯å¢ƒä¸­"å­¦ä¹ "å’Œ"è¿›åŒ–"ï¼Œæœ€ç»ˆæ‰¾åˆ°åœ¨ç‰¹å®šå¸‚åœºæ¡ä»¶ä¸‹è¡¨ç°æœ€ä½³çš„äº¤æ˜“ç­–ç•¥ã€‚