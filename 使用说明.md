# 使用说明

## 🚀 三种启动方式

### 方式1: 简单启动 (推荐)
```powershell
.\simple_start.ps1
```
- ✅ 无编码问题
- ✅ 自动检测环境
- ✅ 自动生成数据
- ✅ 一键开始训练

### 方式2: 快速启动 (备选)
```powershell
.\quick_start.ps1
```
- ✅ 自动检测环境
- ✅ 自动生成示例数据
- ✅ 使用默认参数快速训练
- ✅ 适合首次使用和快速测试

### 方式3: 英文版启动 (无编码问题)
```powershell
.\run_training.ps1
```
- ✅ 完全英文界面
- ✅ 无编码问题
- ✅ 交互式选择
- ✅ 自定义参数

### 方式4: 完整启动 (交互式)
```powershell
.\start_training.ps1
```
- ✅ 交互式选择训练模式
- ✅ 自定义训练参数
- ✅ 选择数据文件
- ✅ 适合高级用户和自定义训练

### 方式5: 批处理启动 (备选)
```bat
start_training.bat
```
- ✅ 双击即可运行
- ✅ 无需PowerShell
- ✅ 兼容性最好
- ✅ 适合不熟悉命令行的用户

## 🔧 环境配置

### 首次使用
```powershell
# 1. 安装Python 3.11环境
.\setup\install_python311.ps1

# 2. 测试环境
.\setup\test_environment.ps1

# 3. 快速开始
.\quick_start.ps1
```

### 手动配置
```powershell
# 安装Python 3.11
# 下载: https://www.python.org/downloads/release/python-3119/

# 安装依赖
py -3.11 -m pip install torch-directml numpy pandas scikit-learn matplotlib seaborn tqdm psutil
```

## 📊 训练参数说明

### GPU版本 (推荐参数)
- **种群大小**: 300-1000
- **进化代数**: 200-500
- **训练时间**: 10-60分钟
- **内存需求**: 4-8GB

### CPU版本 (推荐参数)
- **种群大小**: 100-300
- **进化代数**: 50-200
- **训练时间**: 30-180分钟
- **内存需求**: 2-4GB

### 参数调优建议
```powershell
# 快速测试 (5分钟)
--population_size 50 --generations 20

# 标准训练 (30分钟)
--population_size 200 --generations 100

# 深度训练 (2小时)
--population_size 500 --generations 300
```

## 📁 数据准备

### 数据格式要求
CSV文件必须包含以下列：
- `Open`: 开盘价
- `High`: 最高价  
- `Low`: 最低价
- `Close`: 收盘价
- `Volume`: 成交量

### 示例数据生成
```powershell
# 生成5000个数据点
py -3.11 examples/sample_data_generator.py --samples 5000

# 生成不同市场模式
py -3.11 examples/sample_data_generator.py --pattern trend    # 趋势市场
py -3.11 examples/sample_data_generator.py --pattern sideways # 横盘市场
py -3.11 examples/sample_data_generator.py --pattern volatile # 高波动市场
py -3.11 examples/sample_data_generator.py --pattern mixed    # 混合模式
```

## 📈 结果分析

### 输出文件
训练完成后，在 `results/` 目录找到：
- `best_individual_*.npy`: 最优交易策略
- `training_history_*.json`: 训练过程记录
- `config_*.json`: 训练配置参数
- `training_*.log`: 详细日志

### 关键指标
- **夏普率**: 风险调整后收益，越高越好
- **最大回撤**: 最大亏损幅度，越小越好
- **收益率**: 总收益百分比
- **交易频率**: 交易次数，适中为好

## 🛠️ 故障排除

### 常见问题

#### 1. Python版本问题
```
错误: torch-directml不支持Python 3.13
解决: 安装Python 3.11
命令: .\setup\install_python311.ps1
```

#### 2. GPU不可用
```
错误: DirectML设备初始化失败
解决: 使用CPU版本或更新GPU驱动
命令: python core/main_cpu.py --data_file data/your_data.csv
```

#### 3. 内存不足
```
错误: CUDA out of memory
解决: 减少种群大小或使用CPU版本
参数: --population_size 100
```

#### 4. 数据格式错误
```
错误: 缺少必要的列
解决: 检查CSV文件格式
要求: Open, High, Low, Close, Volume列
```

### 性能优化

#### GPU优化
```powershell
# 设置环境变量
$env:OMP_NUM_THREADS = "4"
$env:DIRECTML_MEMORY_BUDGET = "4096"

# 使用较大批次
--batch_size 1000
```

#### CPU优化
```powershell
# 使用多核心
--n_jobs -1

# 减少内存使用
--population_size 100 --window_size 200
```

## 💡 最佳实践

### 1. 渐进式训练
```powershell
# 第一步: 快速测试 (5分钟)
.\quick_start.ps1

# 第二步: 标准训练 (30分钟)
py -3.11 core/main_gpu.py --data_file data/your_data.csv --population_size 200 --generations 100

# 第三步: 深度训练 (2小时)
py -3.11 core/main_gpu.py --data_file data/your_data.csv --population_size 500 --generations 300
```

### 2. 数据质量检查
```powershell
# 检查数据完整性
py -3.11 -c "
import pandas as pd
df = pd.read_csv('data/your_data.csv')
print(f'数据形状: {df.shape}')
print(f'缺失值: {df.isnull().sum().sum()}')
print(f'价格范围: {df['Close'].min():.2f} - {df['Close'].max():.2f}')
"
```

### 3. 结果验证
```powershell
# 查看训练历史
py -3.11 -c "
import json
with open('results/training_history_latest.json') as f:
    history = json.load(f)
best_fitness = max(h['best_fitness'] for h in history)
print(f'最佳夏普率: {best_fitness:.4f}')
"
```

## 🎯 下一步

1. **环境配置**: 运行 `.\setup\install_python311.ps1`
2. **快速测试**: 运行 `.\quick_start.ps1`
3. **查看结果**: 检查 `results/` 目录
4. **优化参数**: 根据结果调整训练参数
5. **实盘验证**: 使用真实数据验证策略

---

**开始您的AI交易员训练之旅！** 🚀